<html lang= "en-us">
<head>
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" type="text/css" href="../user/jquery-mobile/jquery.mobile-1.4.4.css">

	<script type="text/javascript", src="jquery.min.js"></script>
	<script type="text/javascript" src="../driver/jquery-mobile/jquery.mobile-1.4.4.js"></script>
  <script type="text/javascript" src="../driver/jquery-mobile/Barcode.js"></script>
<script type="text/javascript">


var t;
function syncAjax(u){
		console.log(u);
        var obj=$.ajax(
          {url:u,
           async:false
           }
        ); 
        return $.parseJSON(obj.responseText);
        return console.log(obj.responseText);
        
      }

      $(document).ready(function(){

      $("#refresh").click(function(){
        r=syncAjax("index_json.php?cmd=1&id=1");
        $('#seats').text(r.busapp.seats);
      });

      $("#reserve").click(function(){
        var n = $('#name').val();
        var u = "index_json.php?cmd=8&n="+n;
        return syncAjax(u);
        document.getElementById("reserve").disabled = true;
      });

      $("#generate").click(function(){
        var nn = ($('#getcode').val());
        r=syncAjax("index_json.php?cmd=6&n="+nn);
		$('#inputdata').text(r.busapp.code);
      });

});
</script>	
</head>
<body>

      <div id = "user_page">

      		<div data-role="header">
      		  <div data-role="navbar">
      		    <ul>
      		      <li><a href="#anylink" data-icon="search">Home</a></li>
      		      <li><a href="#anylink" data-icon="search">Page Two</a></li>
      		      <li><a href="#anylink" data-icon="search">Search</a></li>
      		    </ul>
      		  </div>
      		</div>	

	<div role="main" class="ui-content">
	<!-- this is where i get the location of the bus -->
  <p id ='seats'>Refresh For seats</p>


  <div data-role>
    <button id="refresh" data-icon="refresh">Number of people on bus</button>
  </div>
  </div>

<button onclick="getLocation()">Get Bus Location</button>

<div id="mapholder"></div>

<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<!-- this is the en of the code that gets the location of the bus on a map. -->
<h2>Reserve A seat</h2>
  <div id="form">
    <input id ="name" value="" placeholder="Enter name"/>
    <input id = "set_location" value ="" placeholder="Enter location"/> 
    <button id ="reserve" onclick="refresh()">Reserve A Seat</button>
  </div>

  <div>
    <input id ="getcode" value="" placeholder="Enter name"/>
    <button id ="generate" onclick="writeBC(document.getElementById('inputdata').innerHTML)" >Click Twice To Get B/ar Code</button>
    <div id = "inputdata"></div>
    <div id = "bcArea"></div>
</div> 


<script type="text/javascript">

var x = document.getElementById("demo");
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition,showError);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";}
}

function showPosition(position) {
    lat = position.coords.latitude;
    lon = position.coords.longitude;
    latlon = new google.maps.LatLng(lat, lon)
    mapholder = document.getElementById('mapholder')
    mapholder.style.height='250px';
    mapholder.style.width='500px';

    var myOptions={
    center:latlon,zoom:14,
    mapTypeId:google.maps.MapTypeId.ROADMAP,
    mapTypeControl:false,
    navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL}
    }
    
    var map = new google.maps.Map(document.getElementById("mapholder"),myOptions);
    var marker = new google.maps.Marker({position:latlon,map:map,title:"You are here!"});
}

function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED:
            x.innerHTML = "User denied the request for Geolocation."
            break;
        case error.POSITION_UNAVAILABLE:
            x.innerHTML = "Location information is unavailable."
            break;
        case error.TIMEOUT:
            x.innerHTML = "The request to get user location timed out."
            break;
        case error.UNKNOWN_ERROR:
            x.innerHTML = "An unknown error occurred."
            break;
    }
}

      function writeBC(s)
{
    var bc = new AtalasoftBarcode39(s);
    document.getElementById('bcArea').innerHTML = bc.getBarcode(50, 2, 8);
}
        function refresh(){
          document.location.reload(true);
        }
      
    </script>


   

	<div data-role="footer">	
				<h1>Insert	Footer	Text	Here</h1>	
		</div>	
	</div>

</div>

<div >

</div>

</body>
</html>